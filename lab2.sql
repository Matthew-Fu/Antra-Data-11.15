-- List of manufacture countrys and count of types of stockitems of each country (json)select 
json_value(CustomFields, '$.CountryOfManufacture') as ManufactureCountry, 
count(CustomFields)
from Warehouse.StockItems
group by json_value(CustomFields, '$.CountryOfManufacture')-- List of StockGroups and number of stockitems of each group, using stockgroup name as columns (pivot)with CTE1 as (select ws.StockGroupName, count(wsi.StockItemID) as numberfrom Warehouse.StockGroups wsjoin Warehouse.StockItemStockGroups wss on ws.StockGroupID = wss.StockGroupIDjoin Warehouse.StockItems wsi on wss.StockItemID = wsi.StockItemIDgroup by ws.StockGroupName)select 'number' as StockGroups, [Novelty Items], [Clothing], [Mugs], [T-Shirts], [Computing Novelties], [USB Novelties], [Furry Footwear], [Toys], [Packaging Materials]from CTE1pivot(sum(number) for StockGroupName in ([Novelty Items], [Clothing], [Mugs], [T-Shirts], [Computing Novelties], [USB Novelties], [Furry Footwear], [Toys], [Packaging Materials])) as pivottable-- List of customers and their ordered stockitems totals (unit price * quantity) -- on 2014-12-31 (using the unit price of that day) temporal tableselect so.CustomerID, sum(sol.unitPrice * sol.Quantity) as StockitemsTotalfrom sales.orders so join sales.orderlines sol on so.OrderID = sol.OrderIDwhere so.orderdate = '2014-12-31'group by so.CustomerID-- List of customers who are buying more stockitems (quantity only) -- each year from 2013 to 2016with CTE1 as (select so.CustomerID, year(so.OrderDate) as OrderYear, sum(sol.Quantity) as QuantitybyYearfrom sales.orders so join sales.orderlines sol on so.OrderID = sol.OrderIDwhere so.OrderDate between '2013-01-01' and '2016-12-31'group by so.CustomerID, year(so.OrderDate))select a.CustomerIDfrom CTE1 a join (select * from CTE1 where OrderYear = 2014) b on a.CustomerID = b.CustomerID join (select * from CTE1 where OrderYear = 2015) c on b.CustomerID = c.CustomerIDjoin (select * from CTE1 where OrderYear = 2016) d on c.CustomerID = d.CustomerIDwhere a.QuantitybyYear < b.QuantitybyYear and b.QuantitybyYear < c.QuantitybyYear and c.QuantitybyYear < d.QuantitybyYear